stages:
    - setup
    - lint
    - publish

cache:
    paths:
        - node_modules/

setup:fe:
    image: node
    stage: setup
    script:
        - cd frontend
        - npm install

setup:be:
    image: node
    stage: setup
    script:
        - cd backend
        - npm install

lint:fe:
    image: node
    stage: lint
    script:
        - cd frontend
        - npm run lint

lint:be:
    image: node
    stage: lint
    script:
        - cd backend
        - npm run lint

publish:
    stage: publish
    image: docker:latest
    only:
        - master
    before_script:
        - docker info
        - docker login -u gitlab-ci-token -p $CI_BUILD_TOKEN $REGISTRY_URL
    script:
        - docker build . -t "$IMAGE_NAME"
        - docker push "$IMAGE_NAME"
